-- NEKOSPD.lua
-- 1. 清除舊的 UI 防止重複
pcall(function() game.Players.LocalPlayer.PlayerGui.CatFlyV3_Custom:Destroy() end)

local main = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local TextLabel = Instance.new("TextLabel")
local speedInput = Instance.new("TextBox") 
local plus = Instance.new("TextButton")
local mine = Instance.new("TextButton")
local onof = Instance.new("TextButton")
local closebutton = Instance.new("TextButton")
local uiCorner = Instance.new("UICorner") -- 加個圓角更美觀

-- 初始化 UI 屬性
main.Name = "CatFlyV3_Custom"
main.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
main.ResetOnSpawn = false

Frame.Parent = main
Frame.BackgroundColor3 = Color3.fromRGB(163, 255, 137)
Frame.Position = UDim2.new(0.1, 0, 0.4, 0)
Frame.Size = UDim2.new(0, 190, 0, 90) -- 高度微調
Frame.Active = true
Frame.Draggable = true

uiCorner.Parent = Frame
uiCorner.CornerRadius = UDim.new(0, 8)

TextLabel.Parent = Frame
TextLabel.Size = UDim2.new(1, 0, 0, 25)
TextLabel.BackgroundTransparency = 1
TextLabel.Text = " 貓貓加速控制台 "
TextLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
TextLabel.Font = Enum.Font.SourceSansBold
TextLabel.TextScaled = true

-- 速度輸入框
speedInput.Name = "speedInput"
speedInput.Parent = Frame
speedInput.BackgroundColor3 = Color3.fromRGB(255, 85, 0)
speedInput.Position = UDim2.new(0.4, 0, 0.4, 0)
speedInput.Size = UDim2.new(0, 40, 0, 30)
speedInput.Font = Enum.Font.SourceSansBold
speedInput.Text = tostring(_G.CatSpeedValue or 50) -- 讀取全域預設值
speedInput.TextColor3 = Color3.fromRGB(0, 0, 0)
speedInput.TextScaled = true
speedInput.ClearTextOnFocus = true

plus.Parent = Frame
plus.Text = "+"
plus.Size = UDim2.new(0, 30, 0, 30)
plus.Position = UDim2.new(0.65, 0, 0.4, 0)

mine.Parent = Frame
mine.Text = "-"
mine.Size = UDim2.new(0, 30, 0, 30)
mine.Position = UDim2.new(0.2, 0, 0.4, 0)

onof.Parent = Frame
onof.Text = "啟動加速"
onof.Size = UDim2.new(0, 100, 0, 25)
onof.Position = UDim2.new(0.24, 0, 0.75, 0)

closebutton.Parent = Frame
closebutton.Text = "X"
closebutton.Size = UDim2.new(0, 25, 0, 25)
closebutton.Position = UDim2.new(0.85, 0, 0, 0)
closebutton.BackgroundTransparency = 1
closebutton.TextColor3 = Color3.fromRGB(255, 0, 0)

-- --- 核心邏輯 ---
local speeds = _G.CatSpeedValue or 50
local tpwalking = false
local speaker = game.Players.LocalPlayer

-- RGB 循環
task.spawn(function()
    while main.Parent do
        local color = Color3.fromHSV(tick() % 5 / 5, 0.6, 1)
        Frame.BackgroundColor3 = color
        task.wait()
    end
end)

local function updateSpeed(newVal)
    speeds = tonumber(newVal) or speeds
    _G.CatSpeedValue = speeds -- 同步回全域變數
    speedInput.Text = tostring(speeds)
end

speedInput.FocusLost:Connect(function() updateSpeed(speedInput.Text) end)
plus.MouseButton1Click:Connect(function() updateSpeed(speeds + 5) end) -- 每次加 5 比較有感
mine.MouseButton1Click:Connect(function() if speeds > 1 then updateSpeed(speeds - 5) end end)

onof.MouseButton1Click:Connect(function()
    tpwalking = not tpwalking
    if tpwalking then
        onof.Text = "停止加速"
        onof.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        task.spawn(function()
            local hb = game:GetService("RunService").Heartbeat
            while tpwalking do
                hb:Wait()
                local char = speaker.Character
                local hum = char and char:FindFirstChildOfClass("Humanoid")
                if char and hum and hum.MoveDirection.Magnitude > 0 then
                    char:TranslateBy(hum.MoveDirection * (speeds / 10))
                end
            end
        end)
    else
        onof.Text = "啟動加速"
        onof.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    end
end)

closebutton.MouseButton1Click:Connect(function() main:Destroy() end)
