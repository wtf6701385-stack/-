-- [[ JK 完整版 - 下載位置：GitHub/JK ]]
local LP = game.Players.LocalPlayer
local CommF = game:GetService("ReplicatedStorage").Remotes.CommF_
_G.Settings = _G.Settings or {} -- 確保設定存在

-- [1] 完整等級/坐標判定 (NEKO 原始數據)
function GetQuest()
    local lv = LP.Data.Level.Value
    if game.PlaceId == 2753915549 then -- World 1
        if lv <= 9 then return "Bandit", 1, "BanditQuest1", CFrame.new(1059, 15, 1550), CFrame.new(1045, 27, 1560)
        -- ...此處補完 1-2450 級所有 elseif 數據
        end
    end
end

-- [2] 最強 RegisterHit 封包 (解密後 Delta 穩定版)
task.spawn(function()
    local Net = require(game.ReplicatedStorage.Modules.Net)
    while task.wait() do
        if _G.Settings and _G.Settings.Main["Fast Attack"] then
            pcall(function()
                local parts = {}
                for _, v in pairs(game.Workspace.Enemies:GetChildren()) do
                    if v:FindFirstChild("HumanoidRootPart") and (v.HumanoidRootPart.Position - LP.Character.HumanoidRootPart.Position).Magnitude <= 65 then
                        table.insert(parts, {v, v.HumanoidRootPart})
                    end
                end
                if #parts > 0 then
                    Net:RemoteEvent("RegisterHit", true)
                    game.ReplicatedStorage.Modules.Net["RE/RegisterAttack"]:FireServer()
                    game.ReplicatedStorage.Modules.Net["RE/RegisterHit"]:FireServer(parts[1][1].Head, parts, {}, tostring(LP.UserId):sub(2,4)..tostring(coroutine.running()):sub(11,15))
                end
            end)
        end
    end
end)

-- [3] 自動農場循環
task.spawn(function()
    while task.wait(0.3) do
        if _G.Settings.Main["Auto Farm"] then
            pcall(function()
                local m, l, n, qp, mp = GetQuest()
                if not LP.PlayerGui.Main:FindFirstChild("Quest") then
                    LP.Character.HumanoidRootPart.CFrame = qp
                    CommF:InvokeServer("StartQuest", n, l)
                else
                    local target = game.Workspace.Enemies:FindFirstChild(m)
                    if target then
                        LP.Character.HumanoidRootPart.CFrame = target.HumanoidRootPart.CFrame * CFrame.new(0, 35, 0)
                        -- 裝備武器邏輯
                    else LP.Character.HumanoidRootPart.CFrame = mp end
                end
            end)
        end
    end
end)
