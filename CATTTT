-- [[ ğŸ€ NEKO MASTER - FINAL EXECUTOR ğŸ€ ]] --
local Players = game:GetService("Players")
local localPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- [1] é˜²æ­¢é‡è¤‡åŸ·è¡Œèˆ‡æ•¸æ“šåˆå§‹åŒ– ğŸ¾
if _G.NekoRunning then _G.NekoRunning = false task.wait(0.3) end
_G.NekoRunning = true

_G.Settings = { 
    ClickDelay = 0.1, 
    Distance = 500, 
    PullEnemies = false, 
    Mode = "None", -- None, Mob, All
    FOV = 70,
    FastAttack = false,
    AutoV4 = false
}

local Whitelist = { ["Kadys5373"] = true, ["jay04_23"] = true, ["Zn6xx"] = true, ["iandsere"] = true, ["Zadrian664"] = true, ["czr_0416"] = true, ["tw_vic2012"] = true }

-- [2] æˆ°é¬¥æ ¸å¿ƒé‚è¼¯ ğŸ¾
local function DoCombat()
    if not _G.Settings.FastAttack or _G.Settings.Mode == "None" then return end
    
    local char = localPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end

    local Net = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Net")
    local Targets = {}
    local BasePart = nil

    local folder = workspace:FindFirstChild("Enemies") or workspace
    for _, obj in ipairs(folder:GetChildren()) do
        if obj:IsA("Model") and obj ~= char then
            local hum = obj:FindFirstChildOfClass("Humanoid")
            local eroot = obj:FindFirstChild("HumanoidRootPart")
            
            if hum and eroot and hum.Health > 0 then
                local isPlayer = Players:GetPlayerFromCharacter(obj)
                local shouldHit = false
                
                if _G.Settings.Mode == "Mob" and not isPlayer then shouldHit = true
                elseif _G.Settings.Mode == "All" then shouldHit = true end
                
                if shouldHit then
                    local dist = (eroot.Position - root.Position).Magnitude
                    if dist < _G.Settings.Distance then
                        if _G.Settings.PullEnemies then
                            eroot.CanCollide = false
                            eroot.CFrame = root.CFrame * CFrame.new(0, 0, -3)
                        end
                        BasePart = eroot
                        table.insert(Targets, {obj, eroot})
                    end
                end
            end
        end
        if #Targets >= 15 then break end
    end

    if BasePart and #Targets > 0 then
        pcall(function()
            Net.RE["RegisterAttack"]:FireServer(_G.Settings.ClickDelay)
            Net.RE["RegisterHit"]:FireServer(BasePart, Targets)
        end)
    end
end

-- [3] å•Ÿå‹•èˆ‡é€£æ¥é›²ç«¯ ğŸ¾
if Whitelist[localPlayer.Name] then
    local success, UIModule = pcall(function()
        return loadstring(game:HttpGet("https://raw.githubusercontent.com/wtf6701385-stack/-/refs/heads/main/NEKOUI"))()
    end)

    if success and UIModule then
        local Lib = UIModule:CreateLib()
        local Combat = Lib:NewTab("âš”ï¸ æˆ°é¬¥", true)
        local Misc = Lib:NewTab("âš™ï¸ å…¶ä»–", false)

        -- æˆ°é¬¥åŠŸèƒ½é€£çµ ğŸ¾
        Combat:AddToggle("è‡ªå‹•æ”»æ“Š", _G.Settings, "FastAttack")
        Combat:AddToggle("è‡ªå‹•æ‹‰æ€ª", _G.Settings, "PullEnemies")
        Combat:AddToggle("è‡ªå‹• V4 é€²åŒ–", _G.Settings, "AutoV4")
        Combat:AddInput("æ”»æ“Šè·é›¢", _G.Settings, "Distance")
        Combat:AddButton("æ¨¡å¼ï¼šåªæ‰“æ€ª", function() _G.Settings.Mode = "Mob" end)
        Combat:AddButton("æ¨¡å¼ï¼šå…¨æ®ºå–µ", function() _G.Settings.Mode = "All" end)
        Combat:AddButton("æ¨¡å¼ï¼šé—œé–‰", function() _G.Settings.Mode = "None" end)

        -- å…¶ä»–åŠŸèƒ½ ğŸ¾
        Misc:AddInput("è¦–è§’é«˜åº¦ (FOV)", _G.Settings, "FOV")
        Misc:AddToggle("è²“å’ªé€è¦– (ESP)", _G, "ESP", function(s) if s then loadstring(game:HttpGet("https://raw.githubusercontent.com/wtf6701385-stack/-/refs/heads/main/NEKOESP"))() end end)

        -- [4] æ ¸å¿ƒå¾Œå°å¾ªç’° ğŸ¾
        task.spawn(function()
            while _G.NekoRunning do
                pcall(DoCombat)
                
                -- è‡ªå‹• V4
                if _G.Settings.AutoV4 then
                    pcall(function()
                        local awake = localPlayer.Character:FindFirstChild("Awakening") or localPlayer.Backpack:FindFirstChild("Awakening")
                        if awake then awake.RemoteFunction:InvokeServer(true) end
                    end)
                end
                
                Camera.FieldOfView = math.clamp(tonumber(_G.Settings.FOV) or 70, 30, 120)
                task.wait(math.max(tonumber(_G.Settings.ClickDelay) or 0.1, 0.05))
            end
        end)
    else
        warn("å–µï¼ç„¡æ³•è®€å–é›²ç«¯ UIï¼Œè«‹æª¢æŸ¥ç¶²å€ï¼")
    end
else
    localPlayer:Kick("ä¸»äºº...ä½ çš„æ°£å‘³ä¸å°å–µ...ğŸ¾")
end
