-- [[ ğŸ€ NEKO MASTER - COMBAT FULL LOGIC ğŸ€ ]] --
-- å°æŸ’ä¸»è…³æœ¬ï¼šæ”»æ“Šé‚è¼¯å¼·åŠ›å›æ­¸ï¼(è«‹æ­é…é›²ç«¯ UI ä½¿ç”¨å–µğŸ¾)

local Players = game:GetService("Players")
local localPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- [1] é é˜²é‡è¤‡åŸ·è¡Œå–µ ğŸ¾
if _G.NekoRunning then 
    _G.NekoRunning = false 
    task.wait(0.3) 
end
_G.NekoRunning = true

-- [2] æ ¸å¿ƒæ•¸æ“šåº« ğŸ¾
local Settings = { 
    ClickDelay = 0.1, 
    Distance = 500, 
    PullEnemies = false, 
    Mode = "None", 
    FOV = 70 
}

_G.FastAttack = false
_G.AutoV4 = false

local WhitelistNames = { ["Kadys5373"] = true, ["jay04_23"] = true, ["Zn6xx"] = true, ["iandsere"] = true, ["Zadrian664"] = true, ["czr_0416"] = true, ["tw_vic2012"] = true }

-- [3] æ ¸å¿ƒæˆ°é¬¥é‚è¼¯ï¼ˆåŒ…å«å‚·å®³åˆ¤å®šèˆ‡ç›®æ¨™æƒæå–µğŸ¾ï¼‰
local function DoCombatAction()
    local char = localPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root or not _G.FastAttack or Settings.Mode == "None" then return end

    local Net = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Net")
    local Targets = {}
    local BasePart = nil

    -- æƒææ•µå°ç›®æ¨™ ğŸ¾
    local folder = workspace:FindFirstChild("Enemies") or workspace
    for _, obj in ipairs(folder:GetChildren()) do
        if obj:IsA("Model") and obj ~= char then
            local eHum = obj:FindFirstChildOfClass("Humanoid")
            local eRoot = obj:FindFirstChild("HumanoidRootPart")
            
            -- æ¨¡å¼åˆ¤æ–·ï¼šæ‰“æ€ªæˆ–å…¨æ®ºå–µ ğŸ¾
            local isPlayer = Players:GetPlayerFromCharacter(obj)
            local shouldTarget = false
            if Settings.Mode == "Mob" and not isPlayer then shouldTarget = true
            elseif Settings.Mode == "All" then shouldTarget = true end

            if shouldTarget and eHum and eRoot and eHum.Health > 0 then
                local dist = (eRoot.Position - root.Position).Magnitude
                if dist < Settings.Distance then
                    -- è‡ªå‹•æ‹‰æ€ªé‚è¼¯å–µ ğŸ¾
                    if Settings.PullEnemies then
                        eRoot.CanCollide = false
                        eRoot.CFrame = root.CFrame * CFrame.new(0, 0, -3)
                    end
                    -- é¸å®šæ”»æ“Šé»å–µ ğŸ¾
                    BasePart = eRoot
                    table.insert(Targets, {obj, eRoot})
                end
            end
        end
        if #Targets >= 15 then break end -- æ•ˆèƒ½å„ªåŒ–ï¼Œä¸€æ¬¡æœ€å¤šæŠ“15å€‹å–µ
    end

    -- ç™¼å°„å‚·å®³å°åŒ…å–µï¼ğŸ¾
    if BasePart and #Targets > 0 then
        pcall(function()
            Net.RE["RegisterAttack"]:FireServer(Settings.ClickDelay)
            Net.RE["RegisterHit"]:FireServer(BasePart, Targets)
        end)
    end
end

-- [4] å•Ÿå‹•ä»‹é¢èˆ‡åŠŸèƒ½é€£æ¥ ğŸ¾
if WhitelistNames[localPlayer.Name] then
    -- è®€å–ä¸»äººå­˜åœ¨ GitHub çš„ UI åº«å–µ
    local NekoUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/wtf6701385-stack/-/refs/heads/main/NEKOUI"))()
    local Lib = NekoUI:CreateLib()
    
    local Combat = Lib:NewTab("âš”ï¸ æˆ°é¬¥", true)
    local Travel = Lib:NewTab("ğŸš€ ç§»å‹•", false)

    Combat:AddToggle("æ”»æ“Šå¾ªç’°", _G, "FastAttack")
    Combat:AddToggle("è‡ªå‹•æ‹‰æ€ª", Settings, "PullEnemies")
    Combat:AddToggle("è‡ªå‹• V4 é€²åŒ–", _G, "AutoV4")
    Combat:AddInput("è·é›¢", Settings, "Distance")
    Combat:AddButton("æ¨¡å¼ï¼šæ‰“æ€ªå–µ", function() Settings.Mode = "Mob" end)
    Combat:AddButton("æ¨¡å¼ï¼šå…¨éƒ¨æŠ“æŠ“", function() Settings.Mode = "All" end)
    Combat:AddButton("æ¨¡å¼ï¼šé—œé–‰", function() Settings.Mode = "None" end)

    Travel:AddInput("è¦–é‡é«˜åº¦ (FOV)", Settings, "FOV")

    -- [5] æ ¸å¿ƒå¼•æ“å¾ªç’° ğŸ¾
    task.spawn(function()
        while _G.NekoRunning do
            -- åŸ·è¡Œæˆ°é¬¥å–µï¼
            pcall(DoCombatAction)

            -- è‡ªå‹• V4 é€²åŒ–å–µï¼
            if _G.AutoV4 then
                pcall(function()
                    local char = localPlayer.Character
                    local awake = char:FindFirstChild("Awakening") or localPlayer.Backpack:FindFirstChild("Awakening")
                    if awake then awake.RemoteFunction:InvokeServer(true) end
                end)
            end

            -- ç’°å¢ƒåŒæ­¥å–µï¼
            Camera.FieldOfView = math.clamp(tonumber(Settings.FOV) or 70, 30, 120)
            task.wait(math.max(tonumber(Settings.ClickDelay) or 0.1, 0.05))
        end
    end)
else
    localPlayer:Kick("é‚è¼¯éŒ¯èª¤ï¼æ‰¾ä¸åˆ°ä¸»äººçš„æ°£å‘³å–µï¼ğŸ¾")
end
