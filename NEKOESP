-- [[ ğŸ‘ï¸ NEKO SENSE - ULTIMATE INTEGRATION ğŸ¾ ]] --
-- [[ åå­— + ä¸Šä¸‹æ’ç‰ˆ + è¡€æ¢ + ç¢°æ’ç®±é‚Šæ¡† ]] --

if _G.ESPStarted then _G.ESPStarted = false; task.wait(0.2) end
_G.ESPStarted = true

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- å»ºç«‹ ESP å®¹å™¨
local Folder = CoreGui:FindFirstChild("NekoESP") or Instance.new("Folder", CoreGui)
Folder.Name = "NekoESP"

task.spawn(function()
    while _G.ESPStarted do
        for _, p in ipairs(Players:GetPlayers()) do
            if p ~= LocalPlayer then
                local char = p.Character
                local hrp = char and char:FindFirstChild("HumanoidRootPart")
                local hum = char and char:FindFirstChildOfClass("Humanoid")
                
                -- æ ¸å¿ƒåˆ¤å®šï¼šé–‹é—œã€å­˜åœ¨ã€å­˜æ´»
                if _G.ESP and char and hrp and hum and hum.Health > 0 then
                    
                    -- 1. ğŸ¾ BillboardGui ç³»çµ± (æ–‡å­—èˆ‡è¡€æ¢)
                    local bb = Folder:FindFirstChild(p.Name) or Instance.new("BillboardGui", Folder)
                    bb.Name = p.Name; bb.Adornee = hrp; bb.AlwaysOnTop = true
                    bb.Size = UDim2.new(0, 160, 0, 60); bb.ExtentsOffset = Vector3.new(0, 4, 0); bb.Enabled = true
                    
                    -- åå­— (ä¸Šæ–¹)
                    local nameL = bb:FindFirstChild("NameL") or Instance.new("TextLabel", bb)
                    nameL.Name = "NameL"; nameL.Size = UDim2.new(1, 0, 0.4, 0); nameL.Position = UDim2.new(0, 0, 0, 0)
                    nameL.BackgroundTransparency = 1; nameL.Font = "GothamBold"; nameL.TextSize = 14
                    nameL.TextColor3 = Color3.new(1, 1, 1); nameL.TextStrokeTransparency = 0; nameL.Text = "ğŸ¾ " .. p.Name
                    
                    -- æ•¸æ“š (ä¸‹æ–¹: è¡€é‡èˆ‡è·é›¢)
                    local statsL = bb:FindFirstChild("StatsL") or Instance.new("TextLabel", bb)
                    statsL.Name = "StatsL"; statsL.Size = UDim2.new(1, 0, 0.3, 0); statsL.Position = UDim2.new(0, 0, 0.4, 0)
                    statsL.BackgroundTransparency = 1; statsL.Font = "GothamMedium"; statsL.TextSize = 11
                    
                    local healthPercent = hum.Health / hum.MaxHealth
                    local healthColor = Color3.fromRGB(100, 255, 100):Lerp(Color3.fromRGB(255, 50, 50), 1 - healthPercent)
                    local dist = math.floor((hrp.Position - (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character.HumanoidRootPart.Position or Vector3.new())).Magnitude)
                    
                    statsL.TextColor3 = healthColor
                    statsL.Text = string.format("[ %d%% ]  [ %dm ]", math.floor(healthPercent * 100), dist)
                    
                    -- è¡€æ¢è£é£¾
                    local barBg = bb:FindFirstChild("BarBg") or Instance.new("Frame", bb)
                    barBg.Name = "BarBg"; barBg.Size = UDim2.new(0.8, 0, 0, 3); barBg.Position = UDim2.new(0.1, 0, 0.75, 0)
                    barBg.BackgroundColor3 = Color3.new(0, 0, 0); barBg.BorderSizePixel = 0
                    
                    local bar = barBg:FindFirstChild("Bar") or Instance.new("Frame", barBg)
                    bar.Name = "Bar"; bar.Size = UDim2.new(healthPercent, 0, 1, 0)
                    bar.BackgroundColor3 = healthColor; bar.BorderSizePixel = 0

                    -- 2. ğŸ¾ Highlight ç³»çµ± (ç¢°æ’ç®±é‚Šæ¡†)
                    local highlight = char:FindFirstChild("NekoHighlight") or Instance.new("Highlight", char)
                    highlight.Name = "NekoHighlight"
                    highlight.Adornee = char
                    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                    highlight.FillColor = healthColor
                    highlight.FillTransparency = 0.7
                    highlight.OutlineColor = healthColor
                    highlight.OutlineTransparency = 0
                else
                    -- é—œé–‰æˆ–ç§»é™¤
                    if Folder:FindFirstChild(p.Name) then Folder[p.Name].Enabled = false end
                    if char and char:FindFirstChild("NekoHighlight") then char.NekoHighlight:Destroy() end
                end
            end
        end
        task.wait(0.05) -- é«˜é »ç‡åˆ·æ–°
    end
end)
