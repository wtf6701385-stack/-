if not game:IsLoaded() then game.Loaded:Wait() end
local Players = game:GetService("Players")
local LP = Players.LocalPlayer

task.spawn(function()
    local Net = game:GetService("ReplicatedStorage"):WaitForChild("Modules"):WaitForChild("Net")
    local RegAtk = Net:WaitForChild("RE/RegisterAttack")
    local RegHit = Net:WaitForChild("RE/RegisterHit")

    while true do
        if _G.MOB then
            pcall(function()
                local char = LP.Character
                local root = char and char:FindFirstChild("HumanoidRootPart")
                -- 自動拿刀
                local tool = char:FindFirstChildOfClass("Tool") or LP.Backpack:FindFirstChildOfClass("Tool")
                if tool and tool.Parent ~= char then char.Humanoid:EquipTool(tool) end

                if char and root and tool then
                    local targets = {}
                    local candidates = workspace:FindFirstChild("Enemies") and workspace.Enemies:GetChildren() or workspace:GetChildren()
                    
                    for _, v in ipairs(candidates) do
                        local vHum = v:FindFirstChildOfClass("Humanoid")
                        local vRoot = v:FindFirstChild("HumanoidRootPart") or v:FindFirstChild("Torso")
                        if vHum and vHum.Health > 0 and vRoot and not Players:GetPlayerFromCharacter(v) then
                            if not v.Name:lower():find("npc") then
                                -- 拉怪到上方
                                vRoot.CFrame = root.CFrame * CFrame.new(0, 50, 0)
                                table.insert(targets, {v, vRoot})
                            end
                        end
                        if #targets >= 25 then break end
                    end

                    if #targets > 0 then
                        RegAtk:FireServer(0)
                        RegHit:FireServer(targets[1][2], targets)
                    end
                end
            end)
        end
        task.wait(0.15)
    end
end)
