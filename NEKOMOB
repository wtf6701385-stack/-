-- [[ NEKOMOB - 刷怪核心 ]]
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- 獲取遊戲遠端事件
local Net = game:GetService("ReplicatedStorage"):WaitForChild("Modules"):WaitForChild("Net")
local RegAttack = Net:WaitForChild("RE/RegisterAttack")
local RegHit = Net:WaitForChild("RE/RegisterHit")

task.spawn(function()
    while true do
        -- 核心：只看開關，不管別的
        if _G.MOB == true then
            pcall(function()
                local char = player.Character
                local root = char and char:FindFirstChild("HumanoidRootPart")
                local tool = char and char:FindFirstChildOfClass("Tool")
                
                if tool and root then
                    local targets = {}
                    local mainPart = nil
                    
                    for _, v in ipairs(workspace:GetChildren()) do
                        local hum = v:FindFirstChildOfClass("Humanoid")
                        local tRoot = v:FindFirstChild("HumanoidRootPart") or v:FindFirstChild("Torso")
                        
                        -- 條件：是怪、活著、不是玩家、不是 NPC
                        if hum and hum.Health > 0 and tRoot and not Players:GetPlayerFromCharacter(v) then
                            local name = v.Name:lower()
                            if not (name:find("npc") or name:find("shop") or name:find("quest")) then
                                -- 拉怪到上方
                                tRoot.CFrame = root.CFrame * CFrame.new(0, 50, 0)
                                if not mainPart then mainPart = tRoot end
                                table.insert(targets, v)
                            end
                        end
                        if #targets >= 10 then break end
                    end
                    
                    if #targets > 0 and mainPart then
                        RegAttack:FireServer(0)
                        RegHit:FireServer(mainPart, targets)
                    end
                end
            end)
        end
        task.wait(0.1) -- 攻擊速度
    end
end)
