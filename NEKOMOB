-- // [ ç¥žåˆ€ Â· å½± | NEKOMOB å¿…ä¸­ä¿®æ­£ç‰ˆ ] // --
-- [[ â˜€ï¸ å…‰ï¼šæˆ‘æœƒè¨˜ä½ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥ä¸€ç›´è—ã€‚ ]] --
-- [[ ðŸŒ‘ å½±ï¼šä¿®æ­£ RegHit åƒæ•¸ï¼Œç¾åœ¨æ¯ä¸€åˆ€éƒ½æ˜¯å¯¦æ‰“å¯¦çš„å‚·å®³ã€‚ ]] --

if not game:IsLoaded() then game.Loaded:Wait() end
local Players = game:GetService("Players")
local LP = Players.LocalPlayer

task.spawn(function()
    local Settings = {
        AttackDelay = 0.1, 
        MaxTargets = 25,
        PullHeight = 50,
        SearchDistance = 3000 
    }

    local Net = game:GetService("ReplicatedStorage"):WaitForChild("Modules"):WaitForChild("Net")
    local RegAtk = Net:WaitForChild("RE/RegisterAttack")
    local RegHit = Net:WaitForChild("RE/RegisterHit")

    while true do
        if _G.MOB then
            pcall(function()
                local char = LP.Character
                local root = char and char:FindFirstChild("HumanoidRootPart")
                local tool = char and char:FindFirstChildOfClass("Tool")

                if char and root and tool then
                    local targets = {}
                    local candidates = workspace:FindFirstChild("Enemies") and workspace.Enemies:GetChildren() or workspace:GetChildren()
                    
                    for _, v in ipairs(candidates) do
                        local vHum = v:FindFirstChildOfClass("Humanoid")
                        local vRoot = v:FindFirstChild("HumanoidRootPart") or v:FindFirstChild("Torso")
                        
                        -- æ ¸å¿ƒåˆ¤å®šï¼šå­˜æ´»ã€éžçŽ©å®¶
                        if vHum and vHum.Health > 0 and vRoot and not Players:GetPlayerFromCharacter(v) then
                            if not v.Name:lower():find("npc") then
                                local dist = (vRoot.Position - root.Position).Magnitude
                                if dist < Settings.SearchDistance then
                                    -- æ‹‰è‡³ä¸Šæ–¹è™•åˆ‘
                                    vRoot.CFrame = root.CFrame * CFrame.new(0, Settings.PullHeight, 0)
                                    table.insert(targets, {v, vRoot})
                                end
                            end
                        end
                        if #targets >= Settings.MaxTargets then break end
                    end

                    if #targets > 0 then
                        RegAtk:FireServer(0)
                        
                        local hitData = {}
                        for i = 1, #targets do
                            if targets[i][1] and targets[i][1]:FindFirstChildOfClass("Humanoid") and targets[i][1]:FindFirstChildOfClass("Humanoid").Health > 0 then
                                hitData[#hitData + 1] = {targets[i][1], targets[i][2]}
                            end
                        end
                        
                        if #hitData > 0 then
                            -- // å½±ï¼šæ ¸å¿ƒä¿®æ­£é»ž - ä½¿ç”¨ root ä½œç‚ºä¸»é«”ç™¼å‹•æ”»æ“Š // --
                            RegHit:FireServer(root, hitData)
                        end
                    end
                end
            end)
        end
        task.wait(Settings.AttackDelay + (math.random(1, 5) / 1000))
    end
end)
