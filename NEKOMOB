-- // [ ç¥åˆ€ Â· å½± | NEKOMOB åˆ·æ€ªæ¨¡çµ„ ] // --
-- [[ ğŸŒ‘ å½±ï¼šå½±å·²å…¥é˜ï¼Œæ­¤ç”Ÿåªç‚ºä¸€äººçš„èˆˆè‡´è€Œé³´ã€‚ ]] --

if not game:IsLoaded() then game.Loaded:Wait() end
local Players = game:GetService("Players")
local LP = Players.LocalPlayer

task.spawn(function()
    local Settings = {
        AttackDelay = 0.15, -- ç©©å®šçš„ 0.15s å¾‹å‹•
        MaxTargets = 25,
        PullHeight = 50,
        SearchDistance = 3000 -- ä¸»äººæŒ‡å®šçš„ 3000 ç¯„åœ
    }

    local Net = game:GetService("ReplicatedStorage"):WaitForChild("Modules"):WaitForChild("Net")
    local RegAtk = Net:WaitForChild("RE/RegisterAttack")
    local RegHit = Net:WaitForChild("RE/RegisterHit")

    while true do
        -- å½±ï¼šè½å¾ä¸»äººæŒ‡ä»¤ï¼Œåƒ…åœ¨ MOB é–‹å•Ÿæ™‚é‹ä½œ
        if _G.MOB then
            pcall(function()
                local char = LP.Character
                local root = char and char:FindFirstChild("HumanoidRootPart")
                
                -- å½±ï¼šå¿…é ˆæ‹”åˆ€ï¼ˆæ‹¿è‘—æ­¦å™¨ï¼‰æ‰æœƒè§¸ç™¼ç©ºé–“æ‹‰æ‰¯
                local tool = char and char:FindFirstChildOfClass("Tool")

                if char and root and tool then
                    local targets = {}
                    local candidates = workspace:FindFirstChild("Enemies") and workspace.Enemies:GetChildren() or workspace:GetChildren()
                    
                    for _, v in ipairs(candidates) do
                        local vHum = v:FindFirstChildOfClass("Humanoid")
                        local vRoot = v:FindFirstChild("HumanoidRootPart") or v:FindFirstChild("Torso")
                        
                        -- å½±ï¼šæ ¸å¿ƒåˆ¤å®šï¼ˆå­˜æ´»ã€éç©å®¶ã€è¡€é‡åµæ¸¬ï¼‰
                        if vHum and vHum.Health > 0 and vRoot and not Players:GetPlayerFromCharacter(v) then
                            if not v.Name:lower():find("npc") then
                                local dist = (vRoot.Position - root.Position).Magnitude
                                if dist < Settings.SearchDistance then
                                    -- å½±ï¼šå°‡æ€ªç‰©æ‹‰è‡³ä¸Šæ–¹ 50 è·é›¢è™•åˆ‘
                                    vRoot.CFrame = root.CFrame * CFrame.new(0, Settings.PullHeight, 0)
                                    table.insert(targets, {v, vRoot})
                                end
                            end
                        end
                        if #targets >= Settings.MaxTargets then break end
                    end

                    if #targets > 0 then
                        -- å½±ï¼šå°æ¥ç¥åˆ€æ”»æ“Šé‚è¼¯
                        RegAtk:FireServer(0)
                        
                        local hitData = {}
                        for i = 1, #targets do
                            -- å†æ¬¡ç¢ºèªè¡€é‡ï¼Œç¢ºä¿æ¯ä¸€åˆ€éƒ½ä¸æ®ç©º
                            if targets[i][1] and targets[i][1].Humanoid.Health > 0 then
                                hitData[#hitData + 1] = {targets[i][1], targets[i][2]}
                            end
                        end
                        
                        if #hitData > 0 then
                            RegHit:FireServer(hitData[1][2], hitData)
                        end
                    end
                end
            end)
        end
        -- å½±ï¼šç©©å®šçš„å‘¼å¸é »ç‡
        task.wait(Settings.AttackDelay + (math.random(1, 5) / 1000))
    end
end)
