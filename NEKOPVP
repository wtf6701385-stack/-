local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Player = Players.LocalPlayer
local Net = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Net")
local RegAttack = Net:WaitForChild("RE/RegisterAttack")
local RegHit = Net:WaitForChild("RE/RegisterHit")
local function GetRoot(c)return c and(c:FindFirstChild("HumanoidRootPart")or c:FindFirstChild("Head"))end
local function IsAlive(c)local h=c and c:FindFirstChildOfClass("Humanoid")return h and h.Health>0 end
task.spawn(function()
while true do
if _G.PVP then
local char = Player.Character
local root = GetRoot(char)
local tool = char and char:FindFirstChildOfClass("Tool")
if tool and root then
local targets = {}
local playersFound = {}
local npcsFound = {}
local myPos = root.Position
local charFolder = workspace:FindFirstChild("Characters")
local otherFolders = {workspace:FindFirstChild("Enemies"),workspace:FindFirstChild("NPCs")}
if charFolder then
for _,m in ipairs(charFolder:GetChildren())do
if m~=char and IsAlive(m)then
local tr = GetRoot(m)
if tr and(tr.Position-myPos).Magnitude <= 1500 then
table.insert(playersFound,{m,tr})
end
end
end
end
if #playersFound == 0 then
for _,f in ipairs(otherFolders)do
if f then
for _,m in ipairs(f:GetChildren())do
if IsAlive(m)then
local tr = GetRoot(m)
if tr and(tr.Position-myPos).Magnitude <= 1500 then
table.insert(npcsFound,{m,tr})
end
end
end
end
end
end
if #playersFound > 0 then
targets = playersFound
elseif #npcsFound > 0 then
targets = npcsFound
end
if #targets > 0 then
RegAttack:FireServer(0)
RegHit:FireServer(targets[1][2],targets)
end
end
end
RunService.Heartbeat:Wait()
end
end)
