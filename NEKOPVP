-- [[ Neko x FastAttack : High-Speed Edition ]]

-- ===== 0. è‡ªæ®ºå”è­° =====
local scriptId = "NekoFastAtk_Speed_" .. tick()
_G.CurrentFastAtkID = scriptId
_G.FastAttack = _G.FastAttack or true -- é è¨­é–‹å•Ÿ

-- ===== 1. ç’°å¢ƒå„ªåŒ– =====
local _ENV = (getgenv or getrenv or getfenv)()
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- å¿«é€Ÿç²å–é ç«¯äº‹ä»¶
local Modules = ReplicatedStorage:WaitForChild("Modules")
local Net = Modules:WaitForChild("Net")
local RegisterAttack = Net:WaitForChild("RE/RegisterAttack")
local RegisterHit = Net:WaitForChild("RE/RegisterHit")

-- ===== 2. åƒæ•¸è¨­å®š =====
local Settings = {
    AutoClick = true,
    ClickDelay = 0.06,  -- ä½ è¦æ±‚çš„ 0.06
    Distance = 5000     -- ä½ è¦æ±‚çš„ 5000
}

-- ===== 3. æ ¸å¿ƒåŠŸèƒ½ =====
if not _ENV.rz_FastAttack then
    local FastAttack = {
        attackMobs = true,
        attackPlayers = true
    }

    local function IsAlive(char)
        return char and char:FindFirstChild("Humanoid") and char.Humanoid.Health > 0
    end

    function FastAttack:AttackNearest()
        local OthersEnemies = {}
        local TargetPart = nil
        local MyChar = Player.Character
        if not IsAlive(MyChar) then return end
        
        local MyPos = MyChar.PrimaryPart and MyChar.PrimaryPart.Position
        if not MyPos then return end

        -- æƒæå°è±¡ (Enemies & Characters)
        local Folders = {workspace:FindFirstChild("Enemies"), workspace:FindFirstChild("Characters")}
        
        for _, folder in pairs(Folders) do
            if folder then
                for _, enemy in ipairs(folder:GetChildren()) do
                    local head = enemy:FindFirstChild("Head")
                    if head and IsAlive(enemy) and enemy ~= MyChar then
                        local dist = (head.Position - MyPos).Magnitude
                        if dist < Settings.Distance then
                            table.insert(OthersEnemies, { enemy, head })
                            TargetPart = head
                        end
                    end
                end
            end
        end

        -- åŸ·è¡Œæ”»æ“Š
        if #OthersEnemies > 0 and TargetPart then
            RegisterAttack:FireServer(Settings.ClickDelay)
            RegisterHit:FireServer(TargetPart, OthersEnemies)
        end
    end

    function FastAttack:BladeHits()
        local tool = Player.Character and Player.Character:FindFirstChildOfClass("Tool")
        if tool and tool.ToolTip ~= "Gun" then
            self:AttackNearest()
        end
    end

    _ENV.rz_FastAttack = FastAttack
end

-- ===== 4. åŸ·è¡Œè¿´åœˆ =====
task.spawn(function()
    print("ğŸš€ Speed Mode Loaded | Delay: " .. Settings.ClickDelay .. " | Dist: " .. Settings.Distance)

    while _G.CurrentFastAtkID == scriptId do
        if _G.FastAttack and Settings.AutoClick then
            pcall(function()
                _ENV.rz_FastAttack:BladeHits()
            end)
        end
        task.wait(Settings.ClickDelay)
    end
    
    print("ğŸ›‘ Speed Mode Stopped.")
end)
