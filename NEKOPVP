-- [[ GitHub: NEKOPVP - é›¶å¼ç§’æ®ºå°æ¥æ ¸å¿ƒ ]]
if not _G.FastAttack then return end
local CurrentSession = _G.CurrentFastAtkID -- é–å®šå•Ÿå‹•æ™‚çš„ ID

local LP = game.Players.LocalPlayer
local RS = game:GetService("ReplicatedStorage")
local Net = RS:WaitForChild("Modules"):WaitForChild("Net")
local RegAttack = Net:WaitForChild("RE/RegisterAttack")
local RegHit = Net:WaitForChild("RE/RegisterHit")

-- é…ç½®
local Settings = {
    Range = 5000, 
    AttackDelay = 0.1,
    MaxTargets = 20
}

-- æœå°‹ç›®æ¨™ç©å®¶
local function GetPVPTargets()
    local targets = {}
    local center = nil
    local char = LP.Character
    if not (char and char.PrimaryPart) then return nil, {} end
    
    for _, p in pairs(game.Players:GetPlayers()) do
        if p ~= LP and p.Character and p.Character:FindFirstChild("Humanoid") then
            local hum = p.Character.Humanoid
            local root = p.Character:FindFirstChild("HumanoidRootPart")
            if hum.Health > 0 and root then
                local dist = (root.Position - char.PrimaryPart.Position).Magnitude
                if dist <= Settings.Range then
                    if not center then center = root end
                    table.insert(targets, {p.Character, root})
                end
            end
        end
        if #targets >= Settings.MaxTargets then break end
    end
    return center, targets
end

-- æ®ºæˆ®å¾ªç’°
task.spawn(function()
    print("âš”ï¸ NEKO PVP æ ¸å¿ƒï¼šå•Ÿå‹•æˆåŠŸï¼Session: " .. CurrentSession)
    
    while _G.FastAttack and _G.CurrentFastAtkID == CurrentSession do
        local tool = LP.Character and LP.Character:FindFirstChildOfClass("Tool")
        if tool then
            local center, allTargets = GetPVPTargets()
            if center and #allTargets > 0 then
                -- åŸ·è¡Œé›¶å¼æ‰¹é‡æ³¨å…¥
                RegAttack:FireServer(0)
                pcall(function()
                    RegHit:FireServer(center, allTargets)
                end)
            end
        end
        task.wait(Settings.AttackDelay)
    end
    
    print("ğŸ’€ NEKO PVP æ ¸å¿ƒï¼šID è®Šæ›´ï¼Œè‡ªå‹•éŠ·æ¯€ä¸­...")
end)
