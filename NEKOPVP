-- [[ GitHub: NEKOPVP - ç¥åˆ€å¼•æ“ x SessionID å°æ¥ç‰ˆ ]]

-- [ 1. å”¯ä¸€ Session å°æ¥ (é€™æ˜¯ç‚ºäº†é…åˆä¸»è…³æœ¬çš„ KillCombat) ]
local CurrentSession = _G.CurrentFastAtkID 
if not _G.FastAttack or not CurrentSession then return end

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LP = game.Players.LocalPlayer

-- [ 2. ç¥åˆ€çµ„ä»¶æŠ“å– ]
local function GetCore()
    local Net = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Net")
    return Net:WaitForChild("RE/RegisterAttack"), Net:WaitForChild("RE/RegisterHit")
end

-- [ 3. ç¥åˆ€æ®ºæˆ®å¾ªç’° ]
task.spawn(function()
    print("ğŸš€ ç¥åˆ€å¼•æ“ï¼šå°æ¥æ¨¡å¼å•Ÿå‹•ï¼ ID: " .. CurrentSession)
    
    -- åªæœ‰ç•¶ ID åŒ¹é…æ™‚æ‰é‹ä½œï¼Œä¸åŒ¹é…å°±ç«‹å³è‡ªæ®º (é˜²æ­¢å †ç–Š)
    while _G.FastAttack and _G.CurrentFastAtkID == CurrentSession do
        pcall(function()
            local RegAtk, RegHit = GetCore()
            local char = LP.Character
            if not (char and char:FindFirstChild("HumanoidRootPart")) then return end
            
            local targets = {}
            local mainPart = nil
            
            -- ç¥åˆ€æƒæï¼š5000 ç¯„åœå…¨é«”ç©å®¶ (PVP å°ˆç”¨)
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= LP and p.Character and p.Character:FindFirstChild("Humanoid") then
                    local hum = p.Character.Humanoid
                    local root = p.Character:FindFirstChild("HumanoidRootPart")
                    if hum.Health > 0 and root then
                        if (root.Position - char.HumanoidRootPart.Position).Magnitude < 5000 then
                            if not mainPart then mainPart = root end
                            table.insert(targets, {p.Character, root})
                        end
                    end
                end
                if #targets >= 20 then break end -- é™åˆ¶å°åŒ…æµé‡
            end
            
            -- ç¥åˆ€æ³¨å…¥ç™¼å‹•
            if #targets > 0 and mainPart then
                local tool = char:FindFirstChildOfClass("Tool")
                if tool and tool.ToolTip ~= "Gun" then
                    RegAtk:FireServer(0.1) -- ç¥åˆ€æ¥µé€Ÿå»¶é²
                    RegHit:FireServer(mainPart, targets)
                end
            end
        end)
        task.wait(0.1) -- ç¥åˆ€æš´åŠ›é »ç‡
    end
    
    print("ğŸ’€ åµæ¸¬åˆ° ID è®Šæ›´ (KillCombat)ï¼Œç¥åˆ€æ ¸å¿ƒå·²è‡ªæ¯€ã€‚")
end)
