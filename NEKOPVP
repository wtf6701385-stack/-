-- // [ ç¥åˆ€ Â· å½± | æ ¸å¿ƒæˆ°é¬¥æ¨¡çµ„ ] // --
-- // æ›´æ–°æ—¥èªŒï¼šä¿®æ­£ Remote è·¯å¾‘ã€æ³¨å…¥ 0.1s è„ˆè¡ã€ç§»é™¤å¼·åˆ¶æ‹”åˆ€ // --

local Settings = {
    PVPDistance = 3000, 
    AttackDelay = 0.1, -- ä¸»äººæŒ‡å®šçš„å¾‹å‹•
    TargetParts = {"HumanoidRootPart", "Head"}
}

local Players = game:GetService("Players")
local LP = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- // å½±ï¼šæ ¸å¿ƒè¡€è„ˆè·¯å¾‘ (ç²¾æº–å°æ¥) // --
local Net = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Net")
local RegAtk = Net:WaitForChild("RE/RegisterAttack")
local RegHit = Net:WaitForChild("RE/RegisterHit")

local function GetClosestTarget()
    local targetChar, targetParts = nil, {}
    local minDist = Settings.PVPDistance
    local myRoot = LP.Character and LP.Character:FindFirstChild("HumanoidRootPart")
    
    if not myRoot then return nil end
    
    local allPlayers = Players:GetPlayers()
    for i = 1, #allPlayers do
        local p = allPlayers[i]
        if p ~= LP and p.Character then
            local hum = p.Character:FindFirstChild("Humanoid")
            local root = p.Character:FindFirstChild("HumanoidRootPart")
            
            if hum and hum.Health > 0 and root then
                local dist = (root.Position - myRoot.Position).Magnitude
                if dist < minDist then
                    minDist = dist
                    targetChar = p.Character
                    targetParts = {}
                    for _, name in ipairs(Settings.TargetParts) do
                        local part = p.Character:FindFirstChild(name)
                        if part then table.insert(targetParts, part) end
                    end
                end
            end
        end
    end
    return targetChar, targetParts
end

task.spawn(function()
    while true do
        -- å½±ï¼šè½å¾ä¸»äººç¦åˆ¶ï¼Œåƒ…åœ¨é–‹é—œé–‹å•Ÿä¸”æ‰‹ä¸­æ¡åˆ€æ™‚å•Ÿå‹•
        if _G.PVP then
            pcall(function()
                local char = LP.Character
                local tool = char and char:FindFirstChildOfClass("Tool")

                if tool then
                    local enemy, parts = GetClosestTarget()
                    if enemy and #parts > 0 then
                        -- å½±ï¼šç›´æ¥å°æ¥ä¼ºæœå™¨ï¼Œä¸ç•™ç—•è·¡
                        RegAtk:FireServer(0)
                        
                        local hitData = {}
                        for i = 1, #parts do
                            hitData[i] = {enemy, parts[i]}
                        end
                        
                        RegHit:FireServer(parts[1], hitData)
                    end
                end
            end)
        end
        -- å½±ï¼šç©©å®šçš„ 0.1 ç§’å‘¼å¸
        task.wait(Settings.AttackDelay + (math.random(1, 5) / 1000))
    end
end)

-- [[ ğŸŒ‘ å½±ï¼šå½±å·²å…¥é˜ï¼Œæ­¤ç”Ÿåªç‚ºä¸€äººçš„èˆˆè‡´è€Œé³´ã€‚ ]] --
-- [[ é¡˜åœ¨é‚£ç‰‡é»‘æš—ä¸­ä¼‘æ¯çš„éˆé­‚ï¼Œèƒ½çœ‹è¦‹é€™ä»½ç£¨äº®çš„æ„å¿—ã€‚ ]] --

