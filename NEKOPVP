-- // [ â˜€ï¸ å…‰èˆ‡å½±ï¼šç¥åˆ€ Â· å½± | PVP é€²åŒ–çµ‚ç«  ] // --
-- [[ ğŸ¾ å…±åŒï¼šæ³¨å…¥å¿ƒè·³åŒæ­¥èˆ‡ 2025 Delta å”è­°ä¿®æ­£ ]] --

local Settings = {
    PVPDistance = 3000, 
    AttackDelay = 0.05, -- é€²åŒ–ï¼šæ¥µè‡´è„ˆè¡é »ç‡
    TargetParts = {"HumanoidRootPart", "Head"}
}

local Players = game:GetService("Players")
local LP = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Net = game:GetService("ReplicatedStorage"):WaitForChild("Modules"):WaitForChild("Net")
local RegAtk = Net:WaitForChild("RE/RegisterAttack")
local RegHit = Net:WaitForChild("RE/RegisterHit")

-- [ å½±ï¼šé€²åŒ–çš„ç›®æ¨™é–å®šé‚è¼¯ ]
local function GetClosestTarget()
    local targetChar, targetParts = nil, {}
    local minDist = Settings.PVPDistance
    local myRoot = LP.Character and LP.Character:FindFirstChild("HumanoidRootPart")
    if not myRoot then return nil end
    
    local allPlayers = Players:GetPlayers()
    for i = 1, #allPlayers do
        local p = allPlayers[i]
        if p ~= LP and p.Character then
            local hum = p.Character:FindFirstChild("Humanoid")
            local root = p.Character:FindFirstChild("HumanoidRootPart")
            
            if hum and hum.Health > 0 and root then
                local dist = (root.Position - myRoot.Position).Magnitude
                if dist < minDist then
                    minDist = dist
                    targetChar = p.Character
                    targetParts = {}
                    for _, name in ipairs(Settings.TargetParts) do
                        local part = p.Character:FindFirstChild(name)
                        if part then table.insert(targetParts, part) end
                    end
                end
            end
        end
    end
    return targetChar, targetParts
end

-- [ â˜€ï¸ å…‰ï¼šé€²åŒ–çš„å¿ƒè·³åŒæ­¥å¾ªç’° ]
task.spawn(function()
    while true do
        -- ğŸ¾ å…±åŒï¼šåŒæ­¥éŠæˆ²å¼•æ“æ¯ä¸€è·³ï¼Œç¢ºä¿æ”»æ“Šç„¡é–“éš™
        RunService.Heartbeat:Wait()
        
        if _G.PVP then
            pcall(function()
                local char = LP.Character
                local tool = char and char:FindFirstChildOfClass("Tool")

                if tool then
                    local enemy, parts = GetClosestTarget()
                    if enemy and #parts > 0 then
                        -- å½±ï¼šç™¼é€æ”»æ“Šé å‘Š
                        RegAtk:FireServer(0)
                        
                        -- // ğŸŒ‘ å½±ï¼š2025 é€²åŒ–æ•¸æ“šåŒ… // --
                        local hitData = {}
                        for i = 1, #parts do
                            hitData[i] = {enemy, parts[i]}
                        end
                        
                        -- // æ ¸å¿ƒä¿®æ­£ï¼šå°‡ç¬¬ä¸€åƒæ•¸æ”¹ç‚ºæ•µæ–¹éƒ¨ä½ä»¥ç¹éé©—è­‰ // --
                        RegHit:FireServer(parts[1], hitData)
                    end
                end
            end)
        end
        -- é€²åŒ–çš„è„ˆè¡é–“éš”
        task.wait(Settings.AttackDelay + (math.random(1, 10) / 1000))
    end
end)

-- [[ ğŸŒ‘ å½±ï¼šæ­¤åˆƒå·²é€²åŒ–ï¼Œç¾åœ¨ï¼Œå»è®“æ•´ç‰‡å¤§æµ·ç‚ºä¹‹æ²ˆé»˜ã€‚ ]] --
