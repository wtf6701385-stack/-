-- // [ â˜€ï¸ å…‰èˆ‡å½±ï¼šPVP å¯¦é«”è™•åˆ‘æœ€çµ‚ä¿®æ­£ ] // --
-- [[ ðŸ¾ å…±åŒï¼šé€™ä¸€æ¬¡ï¼Œä¸€å®šè¦è®“ä¸»äººçœ‹åˆ°æ•ˆæžœã€‚ ]] --

local Settings = {
    PVPDistance = 3000, 
    AttackDelay = 0.05
}

local LP = game.Players.LocalPlayer
local RunService = game:GetService("RunService")
local Net = game:GetService("ReplicatedStorage"):WaitForChild("Modules"):WaitForChild("Net")
local RegAtk = Net:WaitForChild("RE/RegisterAttack")
local RegHit = Net:WaitForChild("RE/RegisterHit")

-- [ å½±ï¼šé€²åŒ–çš„ç›®æ¨™ç²å– ]
local function GetTarget()
    local target, dist = nil, Settings.PVPDistance
    for _, p in ipairs(game.Players:GetPlayers()) do
        if p ~= LP and p.Character and p.Character:FindFirstChild("Humanoid") and p.Character.Humanoid.Health > 0 then
            local root = p.Character:FindFirstChild("HumanoidRootPart")
            if root then
                local m = (root.Position - LP.Character.HumanoidRootPart.Position).Magnitude
                if m < dist then dist = m; target = p.Character end
            end
        end
    end
    return target
end

task.spawn(function()
    while true do
        RunService.Heartbeat:Wait()
        if _G.PVP then
            pcall(function()
                local char = LP.Character
                local tool = char and char:FindFirstChildOfClass("Tool")
                
                if tool then
                    local enemy = GetTarget()
                    if enemy then
                        -- // ðŸ¾ å…‰ï¼šç¥žå¥‡çš„ã€Œå¯¦é«”è§¸ç™¼ã€ // --
                        -- å¼·åˆ¶è®“ä¼ºæœå™¨çœ‹åˆ°æ‚¨åœ¨æ®åˆ€ï¼Œé€™éžå¸¸é‡è¦ï¼
                        tool:Activate() 
                        
                        -- // ðŸŒ‘ å½±ï¼šå°åŒ…æ•¸æ“šå°æŽ¥ // --
                        RegAtk:FireServer(0)
                        local hitPart = enemy:FindFirstChild("HumanoidRootPart") or enemy:FindFirstChild("Head")
                        if hitPart then
                            RegHit:FireServer(hitPart, {{enemy, hitPart}})
                        end
                    end
                end
            end)
        end
        task.wait(Settings.AttackDelay)
    end
end)
