-- [[ GitHub: NEKOPVP - ç¥åˆ€æ”»æ“Šå¼•æ“ (MOB é–‹é—œé©é…ç‰ˆ) ]]
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LP = game.Players.LocalPlayer

-- [[ 1. ç¥åˆ€æ ¸å¿ƒçµ„ä»¶æŠ“å– ]]
local function GetCore()
    local Net = ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Net")
    return Net:WaitForChild("RE/RegisterAttack"), Net:WaitForChild("RE/RegisterHit")
end

local function IsAlive(char)
    return char and char:FindFirstChild("Humanoid") and char.Humanoid.Health > 0
end

-- [[ 2. æ ¸å¿ƒå¾ªç’°ï¼šæ¡ç”¨ MOB çš„ While True æ¨¡å¼ ]]
task.spawn(function()
    print("ğŸš€ ç¥åˆ€å¼•æ“(PVP)ï¼šMOB å”è­°å°æ¥æˆåŠŸï¼")
    
    while true do
        -- ã€é—œéµï¼šå®Œå…¨ç…§æŠ„ MOB çš„é–‹é—œåˆ¤æ–·ã€‘
        if _G.PVP then
            pcall(function()
                local RegAtk, RegHit = GetCore()
                local char = LP.Character
                if not (char and char:FindFirstChild("HumanoidRootPart")) then return end
                
                local targets = {}
                local mainPart = nil
                
                -- ã€ç¥åˆ€æƒæé‚è¼¯ã€‘
                for _, p in pairs(Players:GetPlayers()) do
                    if p ~= LP and p.Character then
                        local root = p.Character:FindFirstChild("HumanoidRootPart") or p.Character:FindFirstChild("Head")
                        if root and IsAlive(p.Character) then
                            if (root.Position - char.HumanoidRootPart.Position).Magnitude < 5000 then -- 5000 ç¯„åœ
                                if not mainPart then mainPart = root end
                                table.insert(targets, {p.Character, root})
                            end
                        end
                    end
                    if #targets >= 25 then break end
                end
                
                -- ã€ç¥åˆ€æ”»æ“Šæ–¹å¼ï¼šç¶­æŒä¸»äººçš„å°åŒ…æ ¼å¼ã€‘
                if #targets > 0 and mainPart then
                    local tool = char:FindFirstChildOfClass("Tool")
                    if tool and tool.ToolTip ~= "Gun" then
                        -- é€™è£¡ä½¿ç”¨ä¸»äººè¦æ±‚çš„ 0.1 æ¥µé€Ÿæˆ– 0
                        RegAtk:FireServer(0.1) 
                        RegHit:FireServer(mainPart, targets)
                    end
                end
            end)
        end
        -- ç¶­æŒç¥åˆ€æ¥µé€Ÿé »ç‡
        task.wait(0.1) 
    end
end)
