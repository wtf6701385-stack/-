-- [[ 雲端 NEKODET 內容 ]]
_G.TargetCache = { Enemies = {}, Players = {} }

local function GetRoot(c) return c and (c:FindFirstChild("HumanoidRootPart") or c:FindFirstChild("Head")) end
local function IsAlive(c)
    local h = c and c:FindFirstChildOfClass("Humanoid")
    return h and h.Health > 0
end

-- 啟動偵測 (移除 ID 限制，確保一定會跑)
task.spawn(function()
    while _G.PVP do
        local pTemp, eTemp = {}, {}
        local myRoot = GetRoot(game.Players.LocalPlayer.Character)
        if myRoot then
            local myPos = myRoot.Position
            -- 玩家掃描
            local chars = workspace:FindFirstChild("Characters")
            if chars then
                for _, m in ipairs(chars:GetChildren()) do
                    if m ~= game.Players.LocalPlayer.Character and IsAlive(m) then
                        local r = GetRoot(m)
                        if r and (r.Position - myPos).Magnitude <= 1500 then
                            table.insert(pTemp, {m, r})
                        end
                    end
                end
            end
            -- 怪物掃描
            local enems = workspace:FindFirstChild("Enemies")
            if enems then
                for _, m in ipairs(enems:GetChildren()) do
                    if IsAlive(m) then
                        local r = GetRoot(m)
                        if r and (r.Position - myPos).Magnitude <= 1500 then
                            table.insert(eTemp, {m, r})
                        end
                    end
                end
            end
        end
        _G.TargetCache.Players = pTemp
        _G.TargetCache.Enemies = eTemp
        task.wait(0.3)
    end
end)
warn("!!! NEKODET CLOUD LOADED !!!")
