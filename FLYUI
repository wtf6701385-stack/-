local CatLib = {}

function CatLib.Init()
    -- === [1. ‰Ω†ÁöÑ V12 UI ÂÆåÊï¥‰ª£Á¢º - ÁµïÂ∞ç‰∏çÂãï UI] ===
    local main = Instance.new("ScreenGui")
    main.Name = "NekoFlyUI_V12_CleanText"
    main.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    main.ResetOnSpawn = false

    local currentSpeed = 1 

    local Frame = Instance.new("Frame")
    Frame.Name = "MainFrame"
    Frame.Parent = main
    Frame.Size = UDim2.new(0, 210, 0, 130)
    Frame.Position = UDim2.new(0.5, -105, 0.4, 0)
    Frame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
    Frame.BackgroundTransparency = 0.25 
    Frame.BorderSizePixel = 0
    Frame.Active = true
    Frame.Draggable = true

    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = UDim.new(0, 20)
    MainCorner.Parent = Frame

    local UIStroke = Instance.new("UIStroke")
    UIStroke.Thickness = 3
    UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    UIStroke.Parent = Frame

    local TopBar = Instance.new("Frame")
    TopBar.Size = UDim2.new(1, 0, 0, 35)
    TopBar.BackgroundTransparency = 1
    TopBar.Parent = Frame

    local MiniBtn = Instance.new("TextButton")
    MiniBtn.Size = UDim2.new(0, 30, 0, 30)
    MiniBtn.Position = UDim2.new(0, 8, 0, 8)
    MiniBtn.BackgroundTransparency = 1
    MiniBtn.Text = "üê±"
    MiniBtn.TextSize = 22
    MiniBtn.Parent = TopBar

    local CloseBtn = Instance.new("TextButton")
    CloseBtn.Size = UDim2.new(0, 30, 0, 30)
    CloseBtn.Position = UDim2.new(1, -38, 0, 8)
    CloseBtn.BackgroundTransparency = 1
    CloseBtn.Text = "üêæ"
    CloseBtn.TextSize = 20
    CloseBtn.Parent = TopBar

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 1, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "NYAN PROTOCOL"
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 11
    Title.TextColor3 = Color3.new(1, 1, 1)
    Title.Parent = TopBar

    local function applyNekoStyle(btn)
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 12)
        corner.Parent = btn
        local stroke = Instance.new("UIStroke")
        stroke.Thickness = 1.2
        stroke.Color = Color3.new(1, 1, 1)
        stroke.Transparency = 0.8
        stroke.Parent = btn
        btn.MouseEnter:Connect(function() btn.BackgroundTransparency = 0.1 end)
        btn.MouseLeave:Connect(function() btn.BackgroundTransparency = 0.3 end)
    end

    local SpeedRow = Instance.new("Frame")
    SpeedRow.Size = UDim2.new(0, 190, 0, 35)
    SpeedRow.Position = UDim2.new(0.5, -95, 0, 45)
    SpeedRow.BackgroundTransparency = 1
    SpeedRow.Parent = Frame

    local mine = Instance.new("TextButton")
    mine.Text = "‚àí"; mine.Size = UDim2.new(0, 35, 0, 35); mine.BackgroundColor3 = Color3.fromRGB(50, 50, 50); mine.BackgroundTransparency = 0.3; mine.Parent = SpeedRow; applyNekoStyle(mine)

    local plus = Instance.new("TextButton")
    plus.Text = "+"; plus.Size = UDim2.new(0, 35, 0, 35); plus.Position = UDim2.new(1, -35, 0, 0); plus.BackgroundColor3 = Color3.fromRGB(50, 50, 50); plus.BackgroundTransparency = 0.3; plus.Parent = SpeedRow; applyNekoStyle(plus)

    local speedDisp = Instance.new("TextLabel")
    speedDisp.Size = UDim2.new(0, 110, 0, 35); speedDisp.Position = UDim2.new(0.5, -55, 0, 0); speedDisp.BackgroundColor3 = Color3.fromRGB(30, 30, 30); speedDisp.BackgroundTransparency = 0.5; speedDisp.Text = "MEOW: 1"; speedDisp.Font = Enum.Font.GothamBold; speedDisp.TextSize = 14; speedDisp.Parent = SpeedRow; Instance.new("UICorner", speedDisp).CornerRadius = UDim.new(0, 12)

    local ActionRow = Instance.new("Frame")
    ActionRow.Size = UDim2.new(0, 190, 0, 40); ActionRow.Position = UDim2.new(0.5, -95, 0, 85); ActionRow.BackgroundTransparency = 1; ActionRow.Parent = Frame

    local up = Instance.new("TextButton")
    up.Text = "UP"; up.Size = UDim2.new(0, 55, 0, 40); up.BackgroundColor3 = Color3.fromRGB(50, 50, 50); up.BackgroundTransparency = 0.3; up.Font = Enum.Font.GothamBold; up.TextSize = 14; up.Parent = ActionRow; applyNekoStyle(up)

    local down = Instance.new("TextButton")
    down.Text = "DOWN"; down.Size = UDim2.new(0, 55, 0, 40); down.Position = UDim2.new(1, -55, 0, 0); down.BackgroundColor3 = Color3.fromRGB(50, 50, 50); down.BackgroundTransparency = 0.3; down.Font = Enum.Font.GothamBold; down.TextSize = 12; down.Parent = ActionRow; applyNekoStyle(down)

    local onof = Instance.new("TextButton")
    onof.Text = "(=^œâ^=)"; onof.Size = UDim2.new(0, 70, 0, 40); onof.Position = UDim2.new(0.5, -35, 0, 0); onof.BackgroundColor3 = Color3.fromRGB(70, 70, 70); onof.BackgroundTransparency = 0.2; onof.TextSize = 14; onof.Parent = ActionRow; applyNekoStyle(onof)

    local ExpandBtn = Instance.new("TextButton")
    ExpandBtn.Size = UDim2.new(0, 50, 0, 50); ExpandBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20); ExpandBtn.BackgroundTransparency = 0.3; ExpandBtn.Text = "üê±"; ExpandBtn.TextSize = 24; ExpandBtn.Visible = false; ExpandBtn.Parent = main; Instance.new("UICorner", ExpandBtn).CornerRadius = UDim.new(1, 0); local ExpandStroke = Instance.new("UIStroke", ExpandBtn); ExpandStroke.Thickness = 3

    -- === [2. Ê†∏ÂøÉÂäüËÉΩÔºö100% ÂéüÂßãÁñäÂä†È£õË°å + Áõ∏Ê©üÊéßÂà∂] ===
    local speaker = game:GetService("Players").LocalPlayer
    local nowe = false
    local tpwalking = false
    local heartbeat = game:GetService("RunService").Heartbeat

    -- ÂéüÂßãÁñäÂä†È£õË°åÂà∑Êñ∞
    local function refreshFlight()
        tpwalking = false
        task.wait(0.01)
        if nowe then
            tpwalking = true
            for i = 1, currentSpeed do
                task.spawn(function()
                    while tpwalking and speaker.Character and speaker.Character:FindFirstChild("Humanoid") do
                        heartbeat:Wait()
                        local hum = speaker.Character.Humanoid
                        if hum.MoveDirection.Magnitude > 0 then
                            speaker.Character:TranslateBy(hum.MoveDirection)
                        end
                    end
                end)
            end
        end
    end

    onof.MouseButton1Click:Connect(function()
        nowe = not nowe
        local char = speaker.Character
        local root = char and (char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso"))

        if nowe then
            onof.Text = "FLYING"
            char.Humanoid:ChangeState(Enum.HumanoidStateType.Swimming)
            char.Humanoid.PlatformStand = true
            char.Animate.Disabled = true
            refreshFlight()

            -- Ë£úÂõû BodyVelocity Áõ∏Ê©üÊéßÂà∂ÈÇèËºØ
            task.spawn(function()
                local bg = Instance.new("BodyGyro", root)
                bg.P = 9e4; bg.maxTorque = Vector3.new(9e9, 9e9, 9e9); bg.cframe = root.CFrame
                local bv = Instance.new("BodyVelocity", root)
                bv.velocity = Vector3.new(0, 0.1, 0); bv.maxForce = Vector3.new(9e9, 9e9, 9e9)

                local ctrl = {f = 0, b = 0, l = 0, r = 0}
                local mouse = speaker:GetMouse()
                local k1 = mouse.KeyDown:Connect(function(k) if k:lower()=="w" then ctrl.f=1 elseif k:lower()=="s" then ctrl.f=-1 elseif k:lower()=="a" then ctrl.l=-1 elseif k:lower()=="d" then ctrl.r=1 end end)
                local k2 = mouse.KeyUp:Connect(function(k) if k:lower()=="w" or k:lower()=="s" then ctrl.f=0 elseif k:lower()=="a" or k:lower()=="d" then ctrl.l=0 end end)

                while nowe and char and char:FindFirstChild("Humanoid") and char.Humanoid.Health > 0 do
                    game:GetService("RunService").RenderStepped:Wait()
                    bv.velocity = ((workspace.CurrentCamera.CoordinateFrame.lookVector * ctrl.f) + ((workspace.CurrentCamera.CoordinateFrame * CFrame.new(ctrl.l+ctrl.r, (ctrl.f)*0.2, 0).p) - workspace.CurrentCamera.CoordinateFrame.p)) * 50
                    bg.cframe = workspace.CurrentCamera.CoordinateFrame
                end
                bg:Destroy(); bv:Destroy(); k1:Disconnect(); k2:Disconnect()
            end)
        else
            onof.Text = "(=^œâ^=)"
            tpwalking = false
            char.Humanoid.PlatformStand = false
            char.Humanoid:ChangeState(Enum.HumanoidStateType.RunningNoPhysics)
            char.Animate.Disabled = false
        end
    end)

    plus.MouseButton1Click:Connect(function()
        currentSpeed = currentSpeed + 1
        speedDisp.Text = "MEOW: " .. tostring(currentSpeed)
        if nowe then refreshFlight() end
    end)

    mine.MouseButton1Click:Connect(function()
        if currentSpeed > 1 then
            currentSpeed = currentSpeed - 1
            speedDisp.Text = "MEOW: " .. tostring(currentSpeed)
            if nowe then refreshFlight() end
        end
    end)

    -- ‰ΩçÁßªÊåâÈàï
    local isUp, isDown = false, false
    up.MouseButton1Down:Connect(function() isUp = true; while isUp do task.wait(); speaker.Character.HumanoidRootPart.CFrame *= CFrame.new(0,1,0) end end)
    up.MouseButton1Up:Connect(function() isUp = false end)
    down.MouseButton1Down:Connect(function() isDown = true; while isDown do task.wait(); speaker.Character.HumanoidRootPart.CFrame *= CFrame.new(0,-1,0) end end)
    down.MouseButton1Up:Connect(function() isDown = false end)

    -- UI ÊéßÂà∂
    MiniBtn.MouseButton1Click:Connect(function() Frame.Visible = false; ExpandBtn.Visible = true; ExpandBtn.Position = Frame.Position end)
    ExpandBtn.MouseButton1Click:Connect(function() Frame.Visible = true; ExpandBtn.Visible = false end)
    CloseBtn.MouseButton1Click:Connect(function() main:Destroy(); tpwalking = false; nowe = false end)

    -- RGB Ê∏≤Êüì
    task.spawn(function()
        while main.Parent do
            local hue = tick() % 5 / 5
            local rgb = Color3.fromHSV(hue, 0.7, 1)
            UIStroke.Color = rgb; ExpandStroke.Color = rgb; speedDisp.TextColor3 = rgb; onof.TextColor3 = rgb; Title.TextColor3 = rgb; MiniBtn.TextColor3 = rgb; CloseBtn.TextColor3 = rgb
            task.wait()
        end
    end)

    return main
end

return CatLib
