-- [[ Ë≤ìË≤ì UI ÂºïÊìé - NEKOUI ]]
local NekoLib = {}

function NekoLib.Init()
    local UserInputService = game:GetService("UserInputService")
    local RunService = game:GetService("RunService")
    local Players = game:GetService("Players")
    local player = Players.LocalPlayer
    local CoreGui = game:GetService("CoreGui")

    -- Èè°È†≠ÈÇèËºØÔºàÂéüÊ®£‰øùÁïôÔºâ
    local cameraActive = true
    task.spawn(function()
        local function apply()
            player.CameraMaxZoomDistance = 1000
        end
        apply()
        local conn = player.CharacterAdded:Connect(function()
            task.wait(1)
            apply()
        end)
        while cameraActive and task.wait(1) do
            if player.CameraMaxZoomDistance ~= 1000 then
                apply()
            end
        end
        conn:Disconnect()
    end)

    if CoreGui:FindFirstChild("CatCat_Final_Neko") then
        CoreGui.CatCat_Final_Neko:Destroy()
    end

    local gui = Instance.new("ScreenGui", CoreGui)
    gui.Name = "CatCat_Final_Neko"
    gui.ResetOnSpawn = false

    local function getRainbowColor(offset)
        local t = tick() * 0.5 + (offset or 0)
        return Color3.fromHSV(t % 1, 0.6, 1)
    end

    local function getContrast(c)
        return (0.299*c.R + 0.587*c.G + 0.114*c.B) > 0.5
            and Color3.new(0,0,0)
            or Color3.new(1,1,1)
    end

    -- ‰∏ªÊ°Ü
    local MainFrame = Instance.new("Frame", gui)
    MainFrame.Size = UDim2.new(0,380,0,240)
    MainFrame.Position = UDim2.new(0.5,-190,0.5,-120)
    MainFrame.BackgroundColor3 = Color3.fromRGB(15,15,17)
    MainFrame.BorderSizePixel = 0
    MainFrame.Active = true
    MainFrame.Draggable = true
    MainFrame.ClipsDescendants = true

    Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0,12)

    local MainStroke = Instance.new("UIStroke", MainFrame)
    MainStroke.Thickness = 2.5
    MainStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

    local ContentHolder = Instance.new("Frame", MainFrame)
    ContentHolder.Size = UDim2.new(1,0,1,0)
    ContentHolder.BackgroundTransparency = 1

    local Title = Instance.new("TextLabel", ContentHolder)
    Title.Size = UDim2.new(1,-100,0,35)
    Title.Position = UDim2.new(0,15,0,5)
    Title.Text = " ‡∏Ö^‚Ä¢Ôªå‚Ä¢^‡∏Ö  CatCat UI"
    Title.TextColor3 = Color3.new(1,1,1)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 14
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.BackgroundTransparency = 1

    local TabBar = Instance.new("Frame", ContentHolder)
    TabBar.Size = UDim2.new(0,100,1,-60)
    TabBar.Position = UDim2.new(0,12,0,45)
    TabBar.BackgroundTransparency = 1
    Instance.new("UIListLayout", TabBar).Padding = UDim.new(0,6)

    local PageContainer = Instance.new("Frame", ContentHolder)
    PageContainer.Size = UDim2.new(1,-135,1,-65)
    PageContainer.Position = UDim2.new(0,125,0,50)
    PageContainer.BackgroundTransparency = 1

    local FeatureStrokes = {}
    local Lib = {}

    -- ÂàÜÈ†Å
    function Lib:CreateTab(name, isDefault)
        local Page = Instance.new("ScrollingFrame", PageContainer)
        Page.Size = UDim2.new(1,0,1,0)
        Page.BackgroundTransparency = 1
        Page.Visible = isDefault or false
        Page.ScrollBarThickness = 0
        Page.CanvasSize = UDim2.new(0,0,0,0)
        Instance.new("UIListLayout", Page).Padding = UDim.new(0,8)

        local TabBtn = Instance.new("TextButton", TabBar)
        TabBtn.Size = UDim2.new(1,0,0,32)
        TabBtn.BackgroundColor3 = Color3.fromRGB(30,28,35)
        TabBtn.Text = name
        TabBtn.TextColor3 = isDefault and Color3.new(1,1,1) or Color3.new(0.5,0.5,0.5)
        TabBtn.Font = Enum.Font.GothamMedium
        TabBtn.TextSize = 11
        Instance.new("UICorner", TabBtn).CornerRadius = UDim.new(0,6)

        TabBtn.MouseButton1Click:Connect(function()
            for _,p in pairs(PageContainer:GetChildren()) do
                if p:IsA("ScrollingFrame") then
                    p.Visible = false
                end
            end
            for _,b in pairs(TabBar:GetChildren()) do
                if b:IsA("TextButton") then
                    b.TextColor3 = Color3.new(0.5,0.5,0.5)
                end
            end
            Page.Visible = true
            TabBtn.TextColor3 = Color3.new(1,1,1)
        end)

        return Page
    end

    -- ÂéüÊú¨ÊåâÈàïÔºà‰∏çÂãïÔºâ
    function Lib:CreateButton(parent, text, callback)
        local btn = Instance.new("TextButton", parent)
        btn.Size = UDim2.new(0.95,0,0,38)
        btn.BackgroundColor3 = Color3.fromRGB(25,23,28)
        btn.Text = "  üê± "..text
        btn.TextColor3 = Color3.new(1,1,1)
        btn.Font = Enum.Font.GothamMedium
        btn.TextSize = 12
        btn.TextXAlignment = Enum.TextXAlignment.Left
        Instance.new("UICorner", btn)

        local s = Instance.new("UIStroke", btn)
        s.Thickness = 1.2
        s.Transparency = 0.6
        table.insert(FeatureStrokes, s)

        btn.MouseButton1Click:Connect(function()
            if callback then callback(btn) end
        end)

        parent.CanvasSize = UDim2.new(0,0,0,parent.UIListLayout.AbsoluteContentSize.Y + 10)
        return btn
    end

    -- ‚≠ê Êñ∞Â¢ûÔºöËº∏ÂÖ•Ê°ÜÊåâÈàï Row
    function Lib:CreateInputButton(parent, text, default, onChange)
        local row = Instance.new("Frame", parent)
        row.Size = UDim2.new(0.95,0,0,38)
        row.BackgroundColor3 = Color3.fromRGB(25,23,28)
        Instance.new("UICorner", row)

        local s = Instance.new("UIStroke", row)
        s.Thickness = 1.2
        s.Transparency = 0.6
        table.insert(FeatureStrokes, s)

        local btn = Instance.new("TextButton", row)
        btn.Size = UDim2.new(0.6,0,1,0)
        btn.BackgroundTransparency = 1
        btn.Text = "  üê± "..text
        btn.Font = Enum.Font.GothamMedium
        btn.TextSize = 12
        btn.TextXAlignment = Enum.TextXAlignment.Left
        btn.TextColor3 = Color3.new(1,1,1)

        local box = Instance.new("TextBox", row)
        box.Size = UDim2.new(0.35,-6,1,-10)
        box.Position = UDim2.new(0.62,3,0,5)
        box.BackgroundColor3 = Color3.fromRGB(18,16,20)
        box.Text = tostring(default or "")
        box.PlaceholderText = "Ëº∏ÂÖ•"
        box.Font = Enum.Font.Gotham
        box.TextSize = 12
        box.TextColor3 = Color3.new(1,1,1)
        box.ClearTextOnFocus = false
        Instance.new("UICorner", box)

        box:GetPropertyChangedSignal("Text"):Connect(function()
            box.Text = box.Text:gsub("[^%d%.]", "")
        end)

        box.FocusLost:Connect(function()
            if onChange then
                onChange(box.Text)
            end
        end)

        parent.CanvasSize = UDim2.new(0,0,0,parent.UIListLayout.AbsoluteContentSize.Y + 10)
        return {Button = btn, Input = box}
    end

    -- ÂΩ©ËôπÊèèÈÇäÔºàÊïàËÉΩÂÑ™ÂåñÂæåÔºâ
    local acc = 0
    local UPDATE_RATE = 0.03
    local conn
    conn = RunService.Heartbeat:Connect(function(dt)
        if not gui.Parent then
            conn:Disconnect()
            cameraActive = false
            return
        end
        acc += dt
        if acc < UPDATE_RATE then return end
        acc = 0

        local c = getRainbowColor()
        MainStroke.Color = c
        for _,st in pairs(FeatureStrokes) do
            st.Color = c
        end
    end)

    return Lib
end

return NekoLib
