-- [[ ğŸ¾ Delta ç›¸å®¹æ€§è£œä¸ ]] --
if not cloneref then
    getgenv().cloneref = function(obj) return obj end
end

-- å¦‚æœ Delta ä¸æ”¯æ´ä¸€äº›é€²éšå‡½æ•¸ï¼Œé€™èƒ½é˜²æ­¢å ±éŒ¯
if not getgenv().setfpscap then
    getgenv().setfpscap = function() end
end
-- [[ å•Ÿå‹•å¦³çš„è²“è²“ UI ]] --
local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/wtf6701385-stack/-/refs/heads/main/Ok"))()
local win = library.new("NEKO Deltaç‰ˆ")

-- ... (ä¸­é–“çš„å°æ¥ä»£ç¢¼è·Ÿä¹‹å‰ä¸€æ¨£) ...

-- [[ åŠ è¼‰ NEKO å¤§è…¦ ]] --
-- å»ºè­°åŠ è¼‰æ™‚åŒ…ä¸€å±¤ pcallï¼Œé˜²æ­¢ Delta å´©æ½°
task.spawn(function()
    local success, err = pcall(function()
        loadstring(game:HttpGet("å¦³çš„NEKOæª”æ¡ˆé€£çµ"))()
    end)
    if not success then
        warn("ğŸ¾ å½±å­æé†’ï¼šåŠ è¼‰å¤§è…¦å¤±æ•—ï¼ŒåŸå› : " .. tostring(err))
    end
end)


-- 2. åˆå§‹åŒ–å‡Œéœ„ 2 åŸæœ¬çš„æ ¸å¿ƒè¨­å®šè¡¨æ ¼ (å¿…é ˆèˆ‡åŸè…³æœ¬è®Šé‡åä¸€è‡´)
_G.Settings = {
    Main = {
        ["Auto Farm"] = false,
        ["Select Weapon"] = "Melee",
        ["Auto Fast Farm"] = false,
    },
    Setting = {
        ["Fast Attack"] = true,
        ["Auto Haki"] = true,
        ["Attack Aura"] = false,
    },
    Stats = {
        ["Auto Add Melee Stats"] = false,
        ["Auto Add Defense Stats"] = false,
        ["Auto Add Sword Stats"] = false,
    },
    Farm = {
        ["Auto Elite Hunter"] = false,
    }
}

-- 3. å‰µå»º UI åˆ†é 
local MainTab = win:Tab("ä¸»åŠŸèƒ½å–µ")
local FarmSec = MainTab:Section("è‡ªå‹•è¾²å ´è¨­å®š")

-- 4. å°æ¥é–‹é—œ (é€™å°±æ˜¯ç‰½ç·šå–µï¼)
FarmSec:Toggle("å…¨è‡ªå‹•è¾²å ´", function(s)
    _G.Settings.Main["Auto Farm"] = s
end)

FarmSec:Toggle("æ¥µé€Ÿæ”»æ“Š (No CD)", function(s)
    _G.Settings.Setting["Fast Attack"] = s
end)

FarmSec:Toggle("è‡ªå‹•æ­¦è£è‰²", function(s)
    _G.Settings.Setting["Auto Haki"] = s
end)

local StatTab = win:Tab("è‡ªå‹•åŠ é»")
local StatSec = StatTab:Section("å±¬æ€§åˆ†é…")

StatSec:Toggle("è‡ªå‹•åŠ è¿‘æˆ°", function(s)
    _G.Settings.Stats["Auto Add Melee Stats"] = s
end)

print("ğŸ¾ éšæ®µ 1 å®Œæˆï¼šUI å·²å°±ç·’ï¼Œç­‰å¾…å¾ŒçºŒé‚è¼¯ä¸­...")
-- [[ ğŸ¾ éšæ®µ 2ï¼šæ ¸å¿ƒå·¥å…·å‡½æ•¸ç§»æ¤ ]] --

local Players = game:GetService("Players")
local LP = Players.LocalPlayer

-- 1. åŸºç¤æª¢æŸ¥èˆ‡è¨­å®š (é€™äº›æ˜¯åŸæœ¬è…³æœ¬é–‹é ­çš„ local è®Šé‡)
local function CheckLevel()
    local myLevel = LP.Data.Level.Value
    if myLevel >= 1 and myLevel <= 14 then return "Bandit", "BanditQuest1", 1, "Bandit"
    elseif myLevel >= 15 and myLevel <= 29 then return "Monkey", "JungleQuest", 1, "Monkey"
    -- ... (æ­¤è™•çœç•¥ 5000 è¡Œä¸­é‡è¤‡çš„ç­‰ç´šåˆ¤æ–·ï¼Œè«‹ä¸»äººç¢ºä¿ä¹‹å¾Œå®Œæ•´ç‰ˆæœ‰åŒ…å«æ‰€æœ‰åˆ¤æ–·)
    end
end

-- 2. è‡ªå‹•è£å‚™æ­¦å™¨é‚è¼¯
local function EquipWeapon()
    local weaponName = _G.Settings.Main["Select Weapon"] or "Melee"
    if LP.Backpack:FindFirstChild(weaponName) then
        LP.Character.Humanoid:EquipTool(LP.Backpack:FindFirstChild(weaponName))
    end
end

-- 3. è‡ªå‹•åŠ é»é‚è¼¯ (å°æ¥å¦³åœ¨éšæ®µ 1 å¯«çš„ Toggle)
task.spawn(function()
    while task.wait(1) do
        pcall(function()
            if _G.Settings.Stats["Auto Add Melee Stats"] then
                game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("AddPoint", "Melee", 3)
            end
            if _G.Settings.Stats["Auto Add Defense Stats"] then
                game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("AddPoint", "Defense", 3)
            end
            if _G.Settings.Stats["Auto Add Sword Stats"] then
                game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("AddPoint", "Sword", 3)
            end
        end)
    end
end)

-- 4. æ ¸å¿ƒä»»å‹™ç³»çµ± (æ¥å–/æª¢æŸ¥ä»»å‹™)
local function GetQuest()
    local myLevel = LP.Data.Level.Value
    local mobName, questName, questId, npcName = CheckLevel()
    
    if not LP.PlayerGui.Main.Quest.Visible then
        -- é€™è£¡æ”¾ç¬ç§»åˆ° NPC çš„é‚è¼¯ (éšæ®µ 3 æœƒè©³ç´°è£œå®Œ)
        game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("StartQuest", questName, questId)
    end
end

-- 5. è‡ªå‹•é–‹å•Ÿæ­¦è£è‰² (Haki)
task.spawn(function()
    while task.wait(5) do
        if _G.Settings.Setting["Auto Haki"] then
            if not LP.Character:FindFirstChild("HasBuso") then
                game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("Buso")
            end
        end
    end
end)

print("ğŸ¾ éšæ®µ 2 å®Œæˆï¼šå¤§è…¦å‡½æ•¸å·²å°±ç·’ï¼")
-- [[ ğŸ¾ éšæ®µ 3ï¼šä¸»å¾ªç’°å¼•æ“ (ä¸»ç·šåˆ·æ€ªé‚è¼¯) ]] --

local function CheckQuest() -- æª¢æŸ¥ç¾åœ¨æœ‰æ²’æœ‰ä»»å‹™
    return LP.PlayerGui.Main.Quest.Visible
end

local function GetToPos(pos) -- æ ¸å¿ƒç¬ç§»å‡½æ•¸
    if LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
        LP.Character.HumanoidRootPart.CFrame = pos
    end
end

-- å•Ÿå‹•è‡ªå‹•åˆ·æ€ªä¸»å¾ªç’°
task.spawn(function()
    while task.wait() do
        if _G.Settings.Main["Auto Farm"] then
            pcall(function()
                local mobName, questName, questId, npcName = CheckLevel()
                
                -- 1. å¦‚æœæ²’ä»»å‹™ï¼Œå°±è·‘å»æ¥ä»»å‹™
                if not CheckQuest() then
                    local npcPos = workspace.NPCs:FindFirstChild(npcName).Head.CFrame
                    GetToPos(npcPos)
                    task.wait(0.5)
                    game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("StartQuest", questName, questId)
                
                -- 2. å¦‚æœæœ‰ä»»å‹™äº†ï¼Œå°±å»æ‰¾æ€ª
                else
                    local monster = nil
                    for _, v in pairs(workspace.Enemies:GetChildren()) do
                        if v.Name == mobName and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
                            monster = v
                            break
                        end
                    end
                    
                    -- æ‰¾ä¸åˆ°æ€ªå°±å»åˆ·æ€ªé»ç­‰
                    if not monster then
                        local spawnPos = workspace.EnemySpawns:FindFirstChild(mobName).CFrame
                        GetToPos(spawnPos)
                    else
                        -- 3. æŠ“åˆ°æ€ªç‰©ï¼Œç¬ç§»åˆ°æ€ªç‰©é ­ä¸Š 5 æ ¼çš„ä½ç½® (é¿é–‹å‚·å®³)
                        EquipWeapon()
                        GetToPos(monster.HumanoidRootPart.CFrame * CFrame.new(0, 5, 0))
                        
                        -- é€™è£¡é ç•™çµ¦éšæ®µ 4 çš„ RegisterHit æ”»æ“Šå¼•æ“
                    end
                end
            end)
        end
    end
end)

print("ğŸ¾ éšæ®µ 3 å®Œæˆï¼šåˆ·æ€ªå¼•æ“å·²å•Ÿå‹•ï¼")
-- [[ ğŸ¾ éšæ®µ 4ï¼šçµ‚æ¥µæˆ°é¬¥å¼•æ“ (RegisterHit åŠ å¯†æ”»æ“Š) ]] --

local idremote = 101010 -- åŸæœ¬ä»£ç¢¼ä¸­çš„åŠ å¯†ç¨®å­
local remote = game:GetService("ReplicatedStorage").Modules.Net["RE/RegisterHit"]

-- æ ¸å¿ƒæ”»æ“Šå¾ªç’°
task.spawn(function()
    while task.wait() do
        -- åªæœ‰åœ¨é–‹å•Ÿå¿«é€Ÿæ”»æ“Šä¸”æ‰‹ä¸Šæœ‰æ‹¿æ­¦å™¨æ™‚æ‰è§¸ç™¼
        if _G.Settings.Setting["Fast Attack"] and LP.Character:FindFirstChildOfClass("Tool") then
            pcall(function()
                local char = LP.Character
                local hrp = char.HumanoidRootPart
                local tool = char:FindFirstChildOfClass("Tool")
                local parts = {}

                -- æœå°‹åŠå¾‘ 60 å…§çš„æ•µäºº (å…¨å±æ”»æ“Šé‚è¼¯)
                for _, v in ipairs(workspace.Enemies:GetChildren()) do
                    if v:FindFirstChild("HumanoidRootPart") and v.Humanoid.Health > 0 then
                        if (hrp.Position - v.HumanoidRootPart.Position).Magnitude <= 60 then
                            for _, _v in ipairs(v:GetChildren()) do
                                if _v:IsA("BasePart") then
                                    parts[#parts + 1] = {v, _v}
                                end
                            end
                        end
                    end
                end

                -- åŸ·è¡Œ RegisterHit é ç¨‹å‘¼å«
                if #parts > 0 and (tool:GetAttribute("WeaponType") == "Melee" or tool:GetAttribute("WeaponType") == "Sword") then
                    -- é€™è£¡å°±æ˜¯åŸè…³æœ¬æœ€ç²¾è¯çš„ RegisterHit ç¹éé‚è¼¯
                    require(game.ReplicatedStorage.Modules.Net):RemoteEvent("RegisterHit", true)
                    game.ReplicatedStorage.Modules.Net["RE/RegisterAttack"]:FireServer()
                    
                    local head = parts[1][1]:FindFirstChild("Head")
                    if head then
                        -- ç™¼é€æ”»æ“Šå°åŒ… (åŒ…å«åŸæœ¬çš„ ID åç§»è¨ˆç®—)
                        game.ReplicatedStorage.Modules.Net["RE/RegisterHit"]:FireServer(
                            head, 
                            parts, 
                            {}, 
                            tostring(LP.UserId):sub(2, 4) .. tostring(coroutine.running()):sub(11, 15)
                        )
                        
                        -- ç¬¬äºŒé‡åŠ å¯†é©—è­‰å›å‚³
                        remote:FireServer(string.gsub("RE/RegisterHit", ".", function(c)
                            return string.char(bit32.bxor(string.byte(c), math.floor(workspace:GetServerTimeNow() / 10 % 10) + 1))
                        end), bit32.bxor(idremote + 909090, game.ReplicatedStorage.Modules.Net.seed:InvokeServer() * 1))
                    end
                end
            end)
        end
    end
end)

-- è£œä¸Šä¸€å€‹ FPS å„ªåŒ–ï¼Œè®“ Delta è·‘èµ·ä¾†æ›´é †
if setfpscap then setfpscap(1000) end

print("ğŸ¾ ã€æ‰‹è¡“æˆåŠŸã€‘å…¨éƒ¨åŠŸèƒ½å·²å°æ¥å®Œæˆï¼è²“è²“ UI ç¾åœ¨å®Œå…¨æŒæ§äº†å‡Œéœ„å¤§è…¦å–µï¼")
