-- [[ GitHub: NEKO - 穩定校準版 ]]
local success, NEKOLib = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/wtf6701385-stack/-/refs/heads/main/NEKOUI?t="..tick()))()
end)

if not success or not NEKOLib then 
    warn("UI 載入失敗")
    return 
end

local Lib = NEKOLib:Init()
local player = game:GetService("Players").LocalPlayer

-- 全域變數
_G.PVP = false
_G.MOB = false

-- 狀態鎖（確保 loadstring 不會因為連點而重複觸發）
local isLoading = false

-- 優化：將視距拉遠改為每 5 秒執行一次，而不是每幀執行，避免卡頓
task.spawn(function()
    while true do
        pcall(function() player.CameraMaxZoomDistance = 1000 end)
        task.wait(5)
    end
end)

local Tab1 = Lib:CreateTab("貓戰鬥", false)
local btnPVP, btnMOB

-- [[ PVP 模式 ]]
btnPVP = Tab1:AddButton("打架模式 : OFF", function(self)
    if isLoading then return end -- 如果正在加載中，禁止操作
    
    _G.PVP = not _G.PVP
    if _G.PVP then
        _G.MOB = false
        if btnMOB then btnMOB.Text = "  刷怪模式 : OFF" end
        
        -- 使用 task.spawn 異步加載，防止主線程被 loadstring 堵塞導致當機
        task.spawn(function()
            isLoading = true
            pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/wtf6701385-stack/-/refs/heads/main/NEKOPVP?t="..tick()))()
            end)
            isLoading = false
        end)
    end
    self.Text = "  打架模式 : " .. (_G.PVP and "ON" or "OFF")
end)

-- [[ MOB 模式 ]]
btnMOB = Tab1:AddButton("刷怪模式 : OFF", function(self)
    if isLoading then return end
    
    _G.MOB = not _G.MOB
    if _G.MOB then
        _G.PVP = false
        if btnPVP then btnPVP.Text = "  打架模式 : OFF" end
        
        task.spawn(function()
            isLoading = true
            pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/wtf6701385-stack/-/refs/heads/main/NEKOMOB?t="..tick()))()
            end)
            isLoading = false
        end)
    end
    self.Text = "  刷怪模式 : " .. (_G.MOB and "ON" or "OFF")
end)

local Tab2 = Lib:CreateTab("貓功能", false)
Tab2:AddButton("貓貓神速", function() 
    task.spawn(function()
        pcall(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/wtf6701385-stack/-/refs/heads/main/NEKOSPD"))() end)
    end)
end)
